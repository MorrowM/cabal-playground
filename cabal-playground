#!/bin/sh

PLAYGROUND_EDITOR=${PLAYGROUND_EDITOR:-${EDITOR:-vi}}
PLAYGROUNDS_DIR="$HOME/.local/share/cabal-playground"
TIMESTAMP=$(date +"%Y-%m-%d-%H_%M_%S")
PROJECT_NAME="playground-${TIMESTAMP}"
PROJECT_DIR="${PLAYGROUNDS_DIR}/${PROJECT_NAME}"

mkdir -p $PROJECT_DIR
cd $PROJECT_DIR

pkgflags=""
for pkg in $@ ; do
  pkgflags="${pkgflags} -d ${pkg}"
done

cabal init --exe -p playground --version 0.1 -n -q -x deleteme --application-dir . -m -d base $pkgflags
sed -i /extra-source-files:/d playground.cabal
[ -x "$(command -v cabal-fmt)" ] && cabal-fmt --inplace playground.cabal
echo "Successfully created cabal project in $PROJECT_DIR"
$PLAYGROUND_EDITOR $PROJECT_DIR 
